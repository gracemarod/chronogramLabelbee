<!-- Deleting everything on the svg so we can recreate the updated graph -->
<!-- d3.selectAll("svg > *").remove(); -->
<!-- Emptying the array so we won't have duplicates -->
<DOCTYPE html>
<html lan="en">


    <head>
        <script src="https://d3js.org/d3.v3.js"></script>
        <!-- <link rel="stylesheet" type="text/css" href="graphStyle.css"> -->
        <meta charset="utf-8">
    </head>
        <style>
            body {
              font: 11px sans-serif;
            }

            .axis path,
            .axis line {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
            }

            .dot {
              stroke: #000;
            }

            .tooltip {
              position: absolute;
              width: 200px;
              height: 28px;
              pointer-events: none;
            }
        </style>
        <body>
            <!-- <h4>Update<h4> -->
            <div>
                <input name="updateButton"
                       type="button"
                       value="Update"
                       onclick="updateData()"/>
            </div>

            <h3></h3>
            <script type="text/javascript">
            

                var chronogramData = new Array();
                var Tracks_json = '[{"1":{"ID":"1","time":0,"frame":0,"x":1056,"y":540,"cx":1122,"cy":658,"width":132,"height":236,"bool_acts":[true,false,false,false]}}]';

                var Tracks_json1 = '[{"0":{"ID":"0","time":0,"frame":0,"x":1080,"y":500,"cx":1120,"cy":622,"width":80,"height":244,"bool_acts":[false,false,true,false]}},null,null,null,null,null,null,null,null,{"1":{"ID":"1","time":0.425728,"frame":9,"x":1188,"y":456,"cx":1298,"cy":574,"width":220,"height":236,"bool_acts":[false,false,true,false]}},{"1":{"ID":"1","time":0.454555,"frame":10,"x":1180,"y":428,"cx":1318,"cy":562,"width":276,"height":268,"bool_acts":[false,false,false,true]}}]'

                var Tracks_json2 = '[{"0":{"ID":"0","time":0,"frame":0,"x":848,"y":280,"cx":958,"cy":362,"width":220,"height":164,"bool_acts":[false,false,false,true]},"1":{"ID":"1","time":0,"frame":0,"x":1076,"y":508,"cx":1134,"cy":640,"width":116,"height":264,"bool_acts":[true,true,false,false]},"2":{"ID":"2","time":0,"frame":0,"x":1204,"y":468,"cx":1304,"cy":594,"width":200,"height":252,"bool_acts":[true,true,false,false]},"3":{"ID":"3","time":0,"frame":0,"x":200,"y":804,"cx":338,"cy":926,"width":276,"height":244,"bool_acts":[false,true,false,true]},"4":{"ID":"4","time":0,"frame":0,"x":340,"y":1128,"cx":494,"cy":1222,"width":308,"height":188,"bool_acts":[false,false,false,true]},"5":{"ID":"5","time":0,"frame":0,"x":1128,"y":1244,"cx":1262,"cy":1322,"width":268,"height":156,"bool_acts":[false,false,true,false]},"6":{"ID":"6","time":0,"frame":0,"x":1080,"y":968,"cx":1210,"cy":1058,"width":260,"height":180,"bool_acts":[false,true,false,false]},"7":{"ID":"7","time":0,"frame":0,"x":1392,"y":1008,"cx":1454,"cy":1106,"width":124,"height":196,"bool_acts":[false,true,false,false]}},{"0":{"ID":"0","time":0.045464,"frame":1,"x":900,"y":304,"cx":1008,"cy":374,"width":216,"height":140,"bool_acts":[false,false,false,true]},"1":{"ID":"1","time":0.045464,"frame":1,"x":1032,"y":496,"cx":1094,"cy":618,"width":124,"height":244,"bool_acts":[true,true,false,false]},"2":{"ID":"2","time":0.045464,"frame":1,"x":1228,"y":484,"cx":1310,"cy":594,"width":164,"height":220,"bool_acts":[true,true,false,false]},"3":{"ID":"3","time":0.045464,"frame":1,"x":216,"y":812,"cx":332,"cy":940,"width":232,"height":256,"bool_acts":[false,true,false,true]},"4":{"ID":"4","time":0.045464,"frame":1,"x":368,"y":1180,"cx":486,"cy":1248,"width":236,"height":136,"bool_acts":[false,false,false,true]}},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{"0":{"ID":"0","time":0.967411,"frame":21,"x":140,"y":228,"cx":260,"cy":306,"width":240,"height":156,"bool_acts":[false,false,false,true]},"1":{"ID":"1","time":0.967411,"frame":21,"x":572,"y":264,"cx":690,"cy":370,"width":236,"height":212,"bool_acts":[true,true,false,true]},"2":{"ID":"2","time":0.967411,"frame":21,"x":936,"y":488,"cx":1076,"cy":556,"width":280,"height":136,"bool_acts":[false,false,false,true]},"3":{"ID":"3","time":0.967411,"frame":21,"x":304,"y":584,"cx":382,"cy":724,"width":156,"height":280,"bool_acts":[false,true,false,true]},"4":{"ID":"4","time":0.967411,"frame":21,"x":332,"y":1116,"cx":460,"cy":1212,"width":256,"height":192,"bool_acts":[true,true,false,true]}}]'

                var Tracks_json3 = '[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{"0":{"ID":"0","time":5.199421,"frame":114,"x":244,"y":1080,"cx":362,"cy":1190,"width":236,"height":220,"bool_acts":[false,false,true,false]},"1":{"ID":"1","time":5.199421,"frame":114,"x":288,"y":492,"cx":372,"cy":622,"width":168,"height":260,"bool_acts":[true,false,false,true]},"2":{"ID":"2","time":5.199421,"frame":114,"x":100,"y":344,"cx":212,"cy":436,"width":224,"height":184,"bool_acts":[false,false,false,true]},"3":{"ID":"3","time":5.199421,"frame":114,"x":324,"y":140,"cx":382,"cy":272,"width":116,"height":264,"bool_acts":[false,false,true,false]},"4":{"ID":"4","time":5.199421,"frame":114,"x":468,"y":264,"cx":580,"cy":332,"width":224,"height":136,"bool_acts":[false,false,true,false]}},null,null,null,null,null,null,null,null,null,{"0":{"ID":"0","time":5.660841,"frame":124,"x":740,"y":956,"cx":890,"cy":1028,"width":300,"height":144,"bool_acts":[false,false,true,false]},"1":{"ID":"1","time":5.660841,"frame":124,"x":84,"y":396,"cx":226,"cy":454,"width":284,"height":116,"bool_acts":[false,false,false,true]},"2":{"ID":"2","time":5.660841,"frame":124,"x":296,"y":148,"cx":378,"cy":260,"width":164,"height":224,"bool_acts":[false,false,false,true]},"3":{"ID":"3","time":5.660841,"frame":124,"x":288,"y":536,"cx":374,"cy":650,"width":172,"height":228,"bool_acts":[false,false,false,true]},"4":{"ID":"4","time":5.660841,"frame":124,"x":500,"y":284,"cx":594,"cy":394,"width":188,"height":220,"bool_acts":[false,false,false,true]},"5":{"ID":"5","time":5.660841,"frame":124,"x":1084,"y":552,"cx":1186,"cy":704,"width":204,"height":304,"bool_acts":[true,true,false,false]},"6":{"ID":"6","time":5.660841,"frame":124,"x":1172,"y":1124,"cx":1244,"cy":1244,"width":144,"height":240,"bool_acts":[false,false,true,false]}}]'
                

                var bool_acts = [];
                var json_list = [Tracks_json1,Tracks_json2,Tracks_json3]

// }
               function chronoObservation() {
                    this.x = 0;
                    this.y = 0;
                    this.Activity = "";
                }

                function createChronoData(data){

                    var Tracks = JSON.parse(data);
                    var chronoObs = new chronoObservation();
                    
                    for (F in Tracks) {
                        for (id in Tracks[F]) {
                            chronoObs = new chronoObservation();
                            chronoObs.x = F;
                            chronoObs.y = id;
                            //small rectangle for each event
                            if (Tracks[F][id].bool_acts[0]) {
                                chronoObs.Activity = "fanning";
                            } else if (Tracks[F][id].bool_acts[1]) {
                                chronoObs.Activity = "pollenating";
                            } else if (Tracks[F][id].bool_acts[2]) {
                                chronoObs.Activity = "entering";
                            } else if (Tracks[F][id].bool_acts[3]) {
                                chronoObs.Activity = "exiting";
                            }
                            chronogramData.push(chronoObs);
                            }
                        }
                        return chronogramData
                }


                // var Tracks = JSON.parse(json_list[1]);
                // var chronoObs = new chronoObservation();

 
                // for (var i = 0; i < chronogramData.length; i++)
                //     chronogramData.pop();
                chronogramData = createChronoData(json_list[1])
                // console.log("Data: ", chronogramData);
                //chronogramdata => x = frame number and y= bee number
                //frame number/ frame per second
                // d3.selectAll("svg > *").remove();
                    // drawChrono();

                //Make scatter plot graph
                
                var margin = {top: 20,right:20,bottom:30,left:40 },
                    width = 960-margin.left -margin.right,
                    height=500 - margin.top -margin.bottom;
                

                var padding = 30; //for chart edges

                //Create scale functions
                var x = d3.scale.linear()
                    .range([padding, width - padding * 2])
                    .domain([0,
                        d3.max(chronogramData,
                            function(d) {
                                return Number(d.x);})
                    ]);

                var y = d3.scale.linear()
                    .range([height - padding, padding])
                    .domain([0,
                        d3.max(chronogramData,
                            function(d) {
                                return Number(d.y);
                            })
                    ]);
                //draw the x axis
                var xAxis = d3.svg.axis()
                    .scale(x)
                    .orient('bottom')
                    .ticks(5)
                    .tickSize(-height); 

                //draw the y axis 
                var yAxis = d3.svg.axis()
                    .scale(y)
                    .orient('left')
                    .ticks(5)
                    .tickSize(-width);

                    
                //Create svg element
                var svg = d3.select('h3')
                    .append('svg')
                    .attr('width',width )
                    .attr('height', height)

                //Create circle
                svg.selectAll("circle")
                    .data(chronogramData)
                    .enter()
                    .append("circle")  //Add circle svg
                    .attr("cx", function(d) {return x(Number(d.x));})
                    .attr("cy", function(d) {return y(Number(d.y));})
                    .attr("r",5)
                    // .attr("height",  function(d) { return (y(Number(d.y))+10 - y(Number(d.y)));})
                    // .attr("width", function(d) {return (x(Number(d.x)+0.3) - x(d.x));})
                    .style("fill", function(d) {
                            var color = "black";
                            if (d.Activity == "fanning")
                                color = "#99CCFF";
                            else if (d.Activity == "pollenating")
                                color = "#FFFF00";
                            else if (d.Activity == "entering")
                                color = "#CC00FF";
                            else if (d.Activity == "exiting")
                                color = "#00CC99";
                            return color;
                    })
                    .style("stroke", "black");
                    // .attr("r",2);

                //add to X axis
                svg.append('g')
                    .attr('class', 'x axis')
                    .attr("transform", "translate(0," + (height - padding) +")")
                    .call(xAxis);
                    // .append("text")
                    // .text("Frames");

                //add to Y axis
                svg.append('g')
                    .attr('class', 'y axis')
                    .attr("transform","translate(" +padding+ ",0)")
                    .call(yAxis);
                    // .append("text")
                    // .text("Bee ID");

                //On click, update with new data
                // d3.select("h4")
                //   .on("click",function(){
                // var inter = setInterval(function(){
                //     updateData();
                // },5000);

                function updateData(){
                    //parse the test data on json_list
                    for(var i = 0; i < json_list.length; i++){
                        chronogramData = createChronoData(json_list[i])
                        // if (i == (json_list.length)){
                        //      i = 0;
                        // }
                        
                    }  
                    
                      //Update scale domain
                      x.domain([0, d3.max(chronogramData, function(d) {
                                return Number(d.x) ;})])
                      y.domain([0,d3.max(chronogramData,
                            function(d) {
                                return Number(d.y);
                            })]);

                      //Update circles
                      svg.selectAll("circle")
                         .data(chronogramData)
                         .transition()
                         .duration(1000)
                         .each("start", function(){
                            d3.select(this)
                                .attr("fill", "red")
                                .attr("r",7);
                         })
                         .delay(function(d,i){ 
                            return i/chronogramData.length * 500;})//dynamic delay
                         .attr("cx",function(d) {return x(Number(d.x));})
                         .attr("cy",function(d) {return y(Number(d.y));})
                         // .attr("height",  function(d) { return (y(Number(d.y))+10 - y(Number(d.y)));})
                         // .attr("width", function(d) {return (x(Number(d.x)+0.3) - x(d.x));})
                         .each("end",function(){    //end of animation
                            d3.select(this) //this means the current element
                               .transition()
                               .duration(500)
                               .style("stroke", "black")
                               // .attr("fill", "black")   //change color
                               .attr("r",5);    //shange radius
                         }); //end animation

                    //Update X axis
                    svg.select(".x.axis")
                        .transition()
                        .duration(1000)
                        .call(xAxis)

                    //Update y axis
                     svg.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis)   
                  }

            </script>
        </body>
    </head>
</html>